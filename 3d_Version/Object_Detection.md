# 目标检测

## 非极大值抑制
**消除冗余检测框，确保每个真实目标仅保留一个最优检测框。同类框间按置信度排序+IoU过滤，跨类别框互不干扰。**

对检测模型检测出的检测框，首先做id索引的分类:分为ID = 0, ID = 1, ID = 2....  
对相同ID的检测框，比较检测框置信度，从高到低进行降序排序。  
保留检测分数最高的框。  
用这个分数最高的框，计算该框与剩余所有框的IoU。 
IOU小于阈值的，保留到下一轮进行处理。  
IOU大于阈值，则视为同一目标，直接删除，保留那个最高分数的框。  
直到无剩余框。



## 使用假定平面法，将相机坐标系转为3D点云
从相机坐标系获取3D点云时，如果场景中包含一个已知或假定的平面，可以利用这个平面信息来恢复深度并生成点云数据  

假定平面法基于以下前提：
- 场景中存在一个已知或可估计的平面
- 这个平面在相机坐标系中的方程可以确定
- 通过图像像素与平面交点计算3D坐标

步骤：
- 拟合平面，确定平面方程
- 相机模型转换
  - 使用相机内参矩阵K将像素坐标(u,v)转换为相机坐标系中的射线方向
- 计算射线与平面交点
- 生成点云
  - 对所有像素或感兴趣区域的像素重复上述过程，得到一组3D点坐标，形成点云

详细步骤：
1. 构建小车坐标系下的点坐标
   - 前方最远障碍物点在小车坐标系中的位置，用于确定图像中障碍物检测区域的下边界
2. 将这个点从小车坐标系转到相机坐标系
   - 从小车坐标系到相机坐标系：平移 + 旋转
4. 投影到图像平面
   - 使用相机内参从3D投影到2D
   - **u = f_x * (X/Z) + c_x** 、**v = f_y * (Y/Z) + c_y**
   - f_x, f_y：焦距(像素单位)、c_x, c_y：主点坐标(图像中心)、X,Y,Z：相机坐标系下的3D点坐标
5. 边界处理，确保计算得到的坐标在图像范围内
6. 存起来先
7. 每一个像素都经由检测和重投影获取了语义
8. 提取轮廓
